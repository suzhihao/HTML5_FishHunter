<!DOCTYPE html>   
<head>   
<meta charset="UTF-8">  
<title>fishhunter</title>  
<script >
	if(window.DeviceMotionEvent){  
            window.addEventListener("devicemotion",deviceMotionHandler,false);  
       }else{  
         alert("本设备不支持摇一摇");  
       }
	var x=400;
	var y=650;
	var vx=0.0;
	var vy=0.0;

	var nowinTime=1.0;
	var inTime=1.0;

	var context;
	
	var width,height;
	var context;
	var angle = 0;

	var time=400;
	var gaintime=0;
	var needgaintime=20;
	var score=0;
	var distime=0;
	
	var x_rotate,y_rotate;
	
	var fish_png;
	var pic_num=1;
	
function draw(id)
{
   /* var myCanvas = "<canvas id='canvas' width='" + screen.availWidth + "px' height='"+ screen.availHeight + "px'></canvas>";
	document.body.insertAdjacentHTML("beforeEnd", myCanvas);*/
/*	var myCanvas = document.createElement("canvas");
	myCanvas.setAttribute("width", screen.availWidth);
	myCanvas.setAttribute("height", screen.availHeight);
	myCanvas.setAttribute("id", "canvas");
	document.body.appendChild(myCanvas);*/

	var canvas = document.getElementById(id);  
    if (canvas == null)  
        return false;  
    context = canvas.getContext('2d'); 
  	width=canvas.width;
    height=canvas.height;
    
    setInterval(rotate,1000/20);         //十分之一秒
}
function rotate()
{   
    if (time>0)
	{
		time--;
		distime--;
		context.clearRect(0,0,width,height);
		
		//back
/*		image_background = new Image();
		image_background.src = "blue.png";
		context.drawImage(image_background,0,0,width,height);*/
		
		//fish
		image = new Image();
		if(pic_num<10){
			fish_png ="fish_png/fish_00"+pic_num+".png";
			pic_num++;
		}else if(pic_num<=27){
			fish_png ="fish_png/fish_0"+pic_num+".png";
			pic_num++;
		}else{
			pic_num = 1;
		}

		image.src = fish_png;
		//image.src = "fish_png/fish_001.png";
		//image.src = "testgif.gif";
		//net
		image_net = new Image();
		image_net.src = "net.png";
		context.drawImage(image_net,150,350,700,800);
		
		
		//text
		if(time<100)
		{
			context.fillStyle='red';
		}else
		{
			context.fillStyle='green';
		}		
		context.font='italic 80px sans-serif';
		context.textBaseline='top';		
		context.fillText("time: "+parseInt(time/20),0,0);
		context.fillStyle='blue';
		context.fillText("score: "+score,width-350,0);
		
		//rotate
		nowinTime+=0.1;
		if (nowinTime>=inTime)
		{		
			angle=2*Math.PI*Math.random();
			vx=Math.cos(angle)*12;
			vy=Math.sin(angle)*12;
			nowinTime = 0;
			
		}
	
		//move
		x+=x_rotate*5+parseInt(vx);
		y+=parseInt(vy)-y_rotate*5;
		
		//boundary
		if(x<-150)
		{
			x=-150;
		}
		if(y<-150)
		{
			y=-150;
		}
		if(x+250>width)
		{
			x=width-250;
		}
		if(y+250>height)
		{
			y=height-250;
		}

        if(distime<=0)
		{
			context.drawImage(image,x,y,400,400);
		}		
		
		//gain
		if(x>200&&x<500&&y>400&&y<700)
		{
			gaintime++;
			if(gaintime==needgaintime)
			{
				score++;
				gaintime=0;
				x=Math.random()*width;
			    y=Math.random()*height;
				if(distime<=0)
				{
					distime=5;
				}
				
			}
		}
		else
		{
			gaintime=0;
		}

		
	}

}

function deviceMotionHandler(eventData){  
            var acceleration = eventData.accelerationIncludingGravity; 
            x_rotate=acceleration.x;  
            y_rotate=acceleration.y;                   
 }  
</script>  
</head>  
<body onload="draw('canvas');">   
<canvas id="canvas" width=1000 height=1500/>

</body>  
</html>
