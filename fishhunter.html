<!DOCTYPE html>   
<head>   
<title>fishhunter</title> 


</head>  
<body onload="draw('canvas')">  

<canvas id="canvas" width=1000 height=1500/>

</body>  

<script >

 	if(window.DeviceMotionEvent){  
            window.addEventListener("devicemotion",deviceMotionHandler,false);  
       }else{  
         alert("本设备不支持摇一摇");  
       }
	var x=400;
	var y=650;
	var nx=150,ny=350;
	var vx=0.0;
	var vy=0.0;
	var fish_sizex=700,fish_sizey=600,net_sizex=700,net_sizey=800;
	var distance=0.0;
	var nowinTime=2.0;
	var inTime=2.0, rotate_time=0.5;
	
	var width,height;
	var context;
	var angle = -0.5*Math.PI;
	var changeangle=0.0;
	var time=400;
	var gaintime=0;
	var needgaintime=20;
	var score=0;
	var distime=0;
	
	var x_rotate,y_rotate;	
	var fish_png;
	var pic_num=1;
	var myCanvas;
	var context_fish;
function draw(id)
{
/*  var myCanvas = "<canvas id='canvas' width='" + screen.availWidth + "px' height='"+ screen.availHeight + "px'></canvas>";
	document.body.insertAdjacentHTML("beforeEnd", myCanvas);
	var myCanvas = document.createElement("canvas");
	myCanvas.setAttribute("width", screen.availWidth);
	myCanvas.setAttribute("height", screen.availHeight);
	myCanvas.setAttribute("id", "canvas");
	document.body.appendChild(myCanvas);*/

	var canvas = document.getElementById(id);
	myCanvas = document.createElement("canvas");
	myCanvas.setAttribute("width", fish_sizex);
	myCanvas.setAttribute("height", fish_sizey);
	myCanvas.setAttribute("id", "canvas_fish");
	document.body.appendChild(myCanvas);
    if (canvas == null)  
        return false;  
    context = canvas.getContext('2d'); 
	context_fish = myCanvas.getContext('2d');
	context_fish.translate(0.5*fish_sizex,0.5*fish_sizey);
  	width=canvas.width;
    height=canvas.height;
    
    setInterval(rotate,50);         //十分之一秒
}
function rotate()
{   
    if (time>0)
	{
		time--;
		distime--;
		context.clearRect(0,0,width,height);
		context_fish.clearRect(-0.5*fish_sizex,-0.5*fish_sizey,fish_sizex,fish_sizey);
		//back
/*		image_background = new Image();
		image_background.src = "blue.png";
		context.drawImage(image_background,0,0,width,height);*/
		
		image = new Image();
		if(pic_num<10){
			fish_png ="fish_png/fish_00"+pic_num+".png";
			pic_num++;
		}else if(pic_num<=27){
			fish_png ="fish_png/fish_0"+pic_num+".png";
			pic_num++;
		}else{
			pic_num = 1;
		}

		image.src = fish_png;
		
		
		//image.src = "fish_png/fish_001.png";
		//image.src = "testgif.gif";
		//net
		image_net = new Image();
		image_net.src = "net.png";
		context.drawImage(image_net,nx,ny,net_sizex,net_sizey);

		
		//text
		if(time<100)
		{
			context.fillStyle='red';
		}else
		{
			context.fillStyle='green';
		}		
		context.font='italic 80px sans-serif';
		context.textBaseline='top';		
		context.fillText("time: "+parseInt(time/20),0,0);
		context.fillStyle='blue';
		context.fillText("score: "+score,width-350,0);
		
		
		//rotate
		nowinTime+=0.05;
		
		if (nowinTime>=inTime)
		{	
			changeangle=Math.PI*Math.random()-0.5*Math.PI;
			nowinTime = 0;			
		}
		if(nowinTime<inTime*0.5)
		{
			angle+=changeangle/20;	
		    context_fish.rotate(changeangle/20);
		}
		//move
					
		vx=Math.cos(angle)*(-12);
		vy=Math.sin(angle)*(-12);
		x+=parseInt(vx);
		y+=parseInt(vy);
		nx+=x_rotate*8;
		ny-=y_rotate*8;
		//fish_boundary           
		if(x<-fish_sizex*0.4)
		{
			x=-fish_sizex*0.4;
		}
		if(y<-fish_sizey*0.3)
		{
			y=-fish_sizey*0.3;
		}
		if(x+fish_sizex*0.6>width)
		{
			x=width-fish_sizex*0.6;
		}
		if(y+fish_sizey*0.7>height)
		{
			y=height-fish_sizey*0.7;
		}
		
		//net_boundary
		if(nx<-net_sizex*0.4)
		{
			nx=-net_sizex*0.4;
		}
		if(ny<-net_sizey*0.3)
		{
			ny=-net_sizey*0.3;
		}
		if(nx+net_sizex*0.5>width)
		{
			nx=width-net_sizex*0.5;
		}
		if(ny+net_sizey*0.5>height)
		{
			ny=height-net_sizey*0.5;
		}

		//draw
		context_fish.drawImage(image,-0.5*fish_sizex,-0.5*fish_sizey,fish_sizex,fish_sizey);
		if(distime<=0)
		{			
			context.drawImage(myCanvas,x,y,fish_sizex,fish_sizey);
		}	
	
		
		//gain
		distance = Math.sqrt(Math.pow((x+fish_sizex*0.5-nx-net_sizex*0.5),2)+Math.pow((y+fish_sizey*0.5-ny-net_sizey*0.4),2));
		if(distance<net_sizex*0.4)
		{
			gaintime++;
			if(gaintime==needgaintime)
			{
				score++;
				gaintime=0;
				x=Math.random()*width;
			    y=Math.random()*height;
				if(distime<=0)
				{
					distime=5;
				}
				
			}
		}
		else
		{
			gaintime=0;
		}

		
	}

}

function deviceMotionHandler(eventData){  
            var acceleration = eventData.accelerationIncludingGravity; 
            x_rotate=acceleration.x;  
            y_rotate=acceleration.y;                   
 }  
</script>  
</html>
